@using Bookify.Data.Models
@model Room

<div class="modal fade" id="roomDetailsModal" tabindex="-1" aria-labelledby="roomDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xxl modal-dialog-centered room-details-dialog">
        <div class="modal-content room-details-modal shadow-lg">
            <div class="modal-header border-0 pb-0">
                <div>
                    <h5 class="modal-title fw-semibold" id="roomDetailsModalLabel">
                        @(Model.RoomType?.Name ?? "Room") — Room Details
                    </h5>
                    <p class="text-muted mb-0 small">
                        Room #@Model.RoomNumber · @(Model.RoomType?.MaxOccupancy ?? 1) Guests
                    </p>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body pt-3">
                <div class="row g-4 align-items-stretch">
                    <!-- Images / Carousel - 40% -->
                    <div class="col-lg-5 col-md-12">
                        <div id="roomDetailsCarousel" class="carousel slide room-details-carousel" data-bs-ride="carousel">
                            <div class="carousel-inner rounded-4 overflow-hidden position-relative">
                                @{
                                    // Get all images: Priority is GalleryImages, then RoomType.ImageUrl as fallback
                                    var allImages = new List<string>();
                                    
                                    if (Model.GalleryImages != null && Model.GalleryImages.Any())
                                    {
                                        foreach (var img in Model.GalleryImages)
                                        {
                                            if (!string.IsNullOrEmpty(img.ImageUrl))
                                            {
                                                string imagePath;
                                                if (img.ImageUrl.StartsWith("~/"))
                                                {
                                                    imagePath = Url.Content(img.ImageUrl);
                                                }
                                                else if (img.ImageUrl.StartsWith("/"))
                                                {
                                                    imagePath = img.ImageUrl;
                                                }
                                                else
                                                {
                                                    imagePath = Url.Content($"~/images/{img.ImageUrl}");
                                                }
                                                allImages.Add(imagePath);
                                            }
                                        }
                                    }
                                    
                                    // If no gallery images, use RoomType.ImageUrl as fallback
                                    if (!allImages.Any())
                                    {
                                        var fallbackImage = Model.RoomType?.ImageUrl;
                                        if (!string.IsNullOrEmpty(fallbackImage))
                                        {
                                            string fallbackPath;
                                            if (fallbackImage.StartsWith("~/"))
                                            {
                                                fallbackPath = Url.Content(fallbackImage);
                                            }
                                            else if (fallbackImage.StartsWith("/"))
                                            {
                                                fallbackPath = fallbackImage;
                                            }
                                            else
                                            {
                                                fallbackPath = Url.Content($"~/images/{fallbackImage}");
                                            }
                                            allImages.Add(fallbackPath);
                                        }
                                        else
                                        {
                                            allImages.Add(Url.Content("~/images/G1.jpg"));
                                        }
                                    }
                                }
                                
                                @if (allImages.Any())
                                {
                                    @for (int i = 0; i < allImages.Count; i++)
                                    {
                                        <div class="carousel-item @(i == 0 ? "active" : "")">
                                            <img src="@allImages[i]"
                                                 class="d-block w-100"
                                                 alt="@(Model.RoomType?.Name ?? "Room") - Image @(i + 1)"
                                                 loading="lazy"
                                                 style="object-fit: cover;"
                                                 asp-append-version="true" />
                                        </div>
                                    }
                                }
                                else
                                {
                                    <div class="carousel-item active">
                                        <img src="@Url.Content("~/images/G1.jpg")"
                                             class="d-block w-100"
                                             alt="@(Model.RoomType?.Name ?? "Room")"
                                             loading="lazy"
                                             style="object-fit: cover;"
                                             asp-append-version="true" />
                                    </div>
                                }

                                <!-- Carousel Controls - positioned absolutely -->
                                <button class="carousel-control-prev carousel-control-custom" type="button" data-bs-target="#roomDetailsCarousel" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Previous</span>
                                </button>
                                <button class="carousel-control-next carousel-control-custom" type="button" data-bs-target="#roomDetailsCarousel" data-bs-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Next</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Details - 60% -->
                    <div class="col-lg-7 col-md-12">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div class="flex-grow-1">
                                <h4 class="fw-semibold mb-2">@Model.RoomType?.Name</h4>
                                <p class="text-muted mb-0">
                                    @(Model.RoomType?.Description ?? "Experience comfort and elegance with our thoughtfully designed room.")
                                </p>
                            </div>
                            <div class="text-end ms-3">
                                <div class="fs-5 fw-bold text-accent-price" style="display: flex; gap: 6px; align-items: center; white-space: nowrap; flex-wrap: nowrap;">
                                    <span>@(Model.RoomType?.PricePerNight.ToString("N0") ?? "0")</span>
                                    <span>EGP</span>
                                    <span class="fs-6 text-muted fw-normal">/ night</span>
                                </div>
                                <div class="small text-muted mt-1">
                                    Max @Model.RoomType?.MaxOccupancy guests
                                </div>
                            </div>
                        </div>

                        <!-- Key facts -->
                        <div class="row g-3 mb-2">
                            <div class="col-6">
                                <div class="info-pill">
                                    <i class="fa-solid fa-users me-2 icon-accent"></i>
                                    <span>@(Model.RoomType?.MaxOccupancy ?? 1) Guests</span>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="info-pill">
                                    <i class="fa-solid fa-square me-2 icon-accent"></i>
                                    <span>35 m²</span>
                                </div>
                            </div>
                        </div>
                        <div class="small text-muted mb-4">
                            Max @Model.RoomType?.MaxOccupancy guests
                        </div>

                        <!-- Base amenities based on RoomType -->
                        @{
                            var baseServices = new List<string>();
                            var typeName = Model.RoomType?.Name?.ToLower() ?? string.Empty;

                            if (typeName.Contains("suite"))
                            {
                                baseServices = new List<string> { "Cleaning", "Open Buffet" };
                            }
                            else if (typeName.Contains("deluxe"))
                            {
                                baseServices = new List<string> { "Breakfast", "Airport Pickup" };
                            }
                            else // standard / others
                            {
                                baseServices = new List<string> { "WiFi", "Breakfast" };
                            }
                        }

                        <div class="mb-4 mt-4">
                            <h6 class="fw-semibold mb-2">Included Services</h6>
                            <div class="d-flex flex-wrap gap-2">
                                @foreach (var service in baseServices)
                                {
                                    <span class="badge rounded-pill included-service-pill">
                                        <i class="fa-solid fa-check me-1"></i>@service
                                    </span>
                                }
                            </div>
                        </div>

                        <!-- Generic amenities -->
                        <div class="mb-4 mt-4">
                            <h6 class="fw-semibold mb-2">Amenities</h6>
                            <div class="d-flex flex-wrap gap-2">
                                <span class="badge rounded-pill amenity-pill">Free WiFi</span>
                                <span class="badge rounded-pill amenity-pill">Flat-screen TV</span>
                                <span class="badge rounded-pill amenity-pill">Air Conditioning</span>
                                <span class="badge rounded-pill amenity-pill">Mini Bar</span>
                                <span class="badge rounded-pill amenity-pill">Room Service</span>
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="d-flex flex-wrap gap-2 justify-content-start align-items-center mt-4">
                            @{
                                var checkInDate = DateTime.Today.AddDays(1).ToString("yyyy-MM-dd");
                                var checkOutDate = DateTime.Today.AddDays(2).ToString("yyyy-MM-dd");
                                var guests = Model.RoomType?.MaxOccupancy ?? 1;
                                var checkoutUrl = Url.Action("Checkout", "Bookings", new { 
                                    roomId = Model.Id, 
                                    checkIn = checkInDate, 
                                    checkOut = checkOutDate, 
                                    numberOfGuests = guests 
                                });
                            }
                            <a href="@checkoutUrl" class="btn btn-primary px-4 py-2">
                                Book Now
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .room-details-dialog {
        max-width: 1100px;
    }

    .room-details-modal {
        border-radius: 24px;
        border: none;
        overflow-y: auto;
        max-height: 90vh;
        font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: #f7f4ef;
    }

    .room-details-modal .modal-header {
        padding: 1.5rem 1.75rem 0.5rem;
    }

    .room-details-modal .modal-body {
        padding: 1.5rem 1.75rem 1.75rem;
    }

    .room-details-carousel {
        position: relative;
    }

    .room-details-carousel img {
        height: 400px;
        object-fit: cover;
        border-radius: 18px;
        width: 100%;
        max-width: 100%;
        display: block;
    }

    .room-details-carousel .carousel-inner {
        border-radius: 18px;
        overflow: hidden;
    }

    .carousel-control-custom {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 45px;
        height: 45px;
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 50%;
        opacity: 0.8;
        z-index: 10;
    }

    .carousel-control-custom:hover {
        opacity: 1;
        background-color: rgba(255, 255, 255, 1);
    }

    .carousel-control-prev.carousel-control-custom {
        left: 15px;
    }

    .carousel-control-next.carousel-control-custom {
        right: 15px;
    }

    .carousel-control-custom .carousel-control-prev-icon,
    .carousel-control-custom .carousel-control-next-icon {
        filter: invert(1);
    }

    .info-pill {
        display: inline-flex;
        align-items: center;
        padding: 0.5rem 0.9rem;
        border-radius: 999px;
        background-color: #fff8f0;
        border: 1px solid rgba(255, 140, 66, 0.35);
        font-size: 0.85rem;
        color: #3b2c2c;
        width: 100%;
        justify-content: center;
    }

    .icon-accent {
        color: #b45309;
    }

    .included-service-pill {
        background-color: #d1fae5 !important;
        color: #065f46 !important;
        border: 1px solid #6ee7b7 !important;
        font-size: 0.8rem;
        padding: 0.4rem 0.8rem;
    }

    .amenity-pill {
        background-color: #f3f4f6 !important;
        color: #4b5563 !important;
        border: 1px solid #d1d5db !important;
        font-size: 0.8rem;
        padding: 0.4rem 0.8rem;
    }

    .text-accent-price {
        color: #ea580c;
    }

    .btn-primary {
        background: linear-gradient(135deg, #f59e0b 0%, #ea580c 100%);
        border: none;
        font-weight: 600;
        font-size: 16px;
        border-radius: 12px;
        padding: 0.75rem 2rem;
    }

    .btn-primary:hover {
        background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%);
    }

    @@media (max-width: 768px) {
        .room-details-carousel img {
            height: 280px;
            max-width: 100%;
        }

        .room-details-dialog {
            max-width: 95%;
            margin: 1rem auto;
        }

        .room-details-modal {
            max-height: 95vh;
            margin: 0.5rem;
        }

        .col-lg-5,
        .col-lg-7 {
            width: 100%;
            margin-bottom: 1rem;
        }

        .info-pill {
            font-size: 0.8rem;
            padding: 0.4rem 0.7rem;
        }

        .btn-primary {
            width: 100%;
            font-size: 15px;
        }
    }
</style>
